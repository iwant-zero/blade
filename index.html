<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>BLADE</title>
  <link rel="stylesheet" href="./css.html/style.css" />
</head>
<body>
  <!-- HUD -->
  <div id="ui">
    <div id="stats">LV.1 에테르 기사</div>

    <div class="bar-container">
      <div id="hp-fill"></div>
    </div>

    <div id="awk-timer" style="display:none;">OVERDRIVE: 0.0s</div>

    <div id="score">SCORE: 0</div>

    <div class="bar-container exp">
      <div id="exp-fill"></div>
    </div>
  </div>

  <div id="item-msg"></div>

  <!-- Pause Button -->
  <button id="pause-btn" type="button" aria-label="pause">⏸</button>

  <!-- Debug -->
  <div id="debug"></div>

  <!-- ===== TITLE MENU ===== -->
  <div id="title-menu" aria-hidden="true">
    <div class="panel">
      <div class="panel-title">BLADE</div>
      <div class="panel-sub">하이비지블리티 · 자동전투</div>

      <div class="save-box" id="save-box" style="display:none;">
        <div class="save-title">저장 데이터 발견</div>
        <div class="save-meta" id="save-meta">-</div>
      </div>

      <div class="panel-buttons">
        <button class="menu-btn" id="btn-title-resume" type="button" style="display:none;">저장 불러오기</button>
        <button class="menu-btn" id="btn-title-new" type="button">새 게임</button>
      </div>

      <div class="panel-buttons">
        <button class="menu-btn ghost" id="btn-title-clear" type="button" style="display:none;">저장 삭제</button>
      </div>

      <div class="hint">
        조작: A/D 이동 · Space 점프 · P/ESC/⏸ 일시정지
      </div>
      <div class="hint dim">
        권장: VSCode Live Server / 로컬 서버 실행
      </div>
    </div>
  </div>

  <!-- ===== PAUSE MENU ===== -->
  <div id="pause-menu" aria-hidden="true">
    <div class="panel">
      <div class="panel-title">PAUSED</div>
      <div class="panel-sub">P / ESC / ⏸ : 토글</div>

      <div class="panel-buttons">
        <button class="menu-btn" id="btn-resume" type="button">재개</button>
        <button class="menu-btn" id="btn-save" type="button">저장</button>
        <button class="menu-btn" id="btn-restart" type="button">새 게임</button>
        <button class="menu-btn ghost" id="btn-to-title" type="button">타이틀</button>
      </div>

      <div class="hint dim">자동 저장: 플레이 중 8초마다</div>
    </div>
  </div>

  <!-- ===== REWARD MENU ===== -->
  <div id="reward-menu" aria-hidden="true">
    <div class="panel">
      <div class="panel-title">BOSS CLEAR</div>
      <div class="panel-sub" id="reward-sub">WAVE 1 → 2</div>

      <div class="reward-grid">
        <button class="reward-btn" id="reward-0" type="button">
          <div class="reward-name" id="reward-name-0">-</div>
          <div class="reward-desc" id="reward-desc-0">-</div>
        </button>
        <button class="reward-btn" id="reward-1" type="button">
          <div class="reward-name" id="reward-name-1">-</div>
          <div class="reward-desc" id="reward-desc-1">-</div>
        </button>
        <button class="reward-btn" id="reward-2" type="button">
          <div class="reward-name" id="reward-name-2">-</div>
          <div class="reward-desc" id="reward-desc-2">-</div>
        </button>
      </div>

      <div class="hint dim">보상 1개 선택 후 즉시 다음 웨이브 시작</div>
    </div>
  </div>

  <!-- ===== GAME OVER ===== -->
  <div id="overlay" aria-hidden="true">
    <div class="panel">
      <div class="panel-title">GAME OVER</div>
      <div id="final-result" class="final-result">-</div>

      <div class="panel-buttons">
        <!-- ✅ 저장 있으면 나타나는 버튼 -->
        <button class="menu-btn" id="btn-over-load" type="button" style="display:none;">저장 불러오기</button>
        <button class="menu-btn" id="btn-retry" type="button">새 게임</button>
        <button class="menu-btn ghost" id="btn-over-title" type="button">타이틀</button>
      </div>

      <div class="hint dim">
        ※ 저장 불러오기는 “마지막 저장 시점”으로 돌아갑니다.
      </div>
    </div>
  </div>

  <canvas id="gameCanvas"></canvas>

  <!-- JS error viewer -->
  <script>
    (function(){
      const debug = document.getElementById('debug');
      function show(msg){
        if(!debug) return;
        debug.style.display='block';
        debug.textContent = msg;
      }
      window.__blade_show_debug = show;

      window.addEventListener('error', (e)=>{
        show(`JS ERROR: ${e.message}\n${e.filename}:${e.lineno}:${e.colno}`);
      });
      window.addEventListener('unhandledrejection', (e)=>{
        const r = (e && e.reason) ? (e.reason.stack || e.reason.message || String(e.reason)) : 'unknown';
        show(`PROMISE ERROR:\n${r}`);
      });

      setTimeout(()=>{
        if(!window.__BLADE_BOOTED){
          show(
            "game.js가 실행되지 않았습니다.\n" +
            "경로: ./js.html/game.js\n" +
            "Blade/index.html 과 같은 레벨에 js.html 폴더 + game.js가 있는지 확인하세요.\n" +
            "※ Live Server 권장"
          );
        }
      }, 2000);
    })();
  </script>

  <script src="./js.html/game.js" defer
    onerror="window.__blade_show_debug && window.__blade_show_debug('game.js 로드 실패!\\n경로: ./js.html/game.js\\n폴더/파일 이름을 확인하세요.');">
  </script>
</body>
</html>
