<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>BLADE</title>
  <link rel="stylesheet" href="./css.html/style.css" />
</head>
<body>
  <!-- HUD -->
  <div id="ui">
    <div id="stats">LV.1 에테르 기사</div>
    <div class="bar-container"><div id="hp-fill"></div></div>
    <div id="awk-timer" style="display:none;">OVERDRIVE: 0.0s</div>
    <div id="score">SCORE: 0</div>
    <div class="bar-container exp"><div id="exp-fill"></div></div>
  </div>

  <div id="item-msg"></div>

  <!-- Pause Button -->
  <button id="pause-btn" type="button" aria-label="pause">⏸</button>

  <!-- Debug -->
  <div id="debug"></div>

  <!-- ===== TITLE MENU ===== -->
  <div id="title-menu" aria-hidden="true" style="display:none;">
    <div class="panel">
      <div class="panel-title">BLADE</div>
      <div class="panel-sub" id="title-sub">세이브 슬롯 3개 · 보스 체크포인트</div>

      <!-- ✅ 플레이 중 TITLE 열었을 때만 보이는 “뒤로가기” -->
      <div class="panel-buttons" style="margin:6px 0 10px;">
        <button class="menu-btn ghost" id="btn-title-back" type="button" style="display:none;">
          BACK TO GAME
        </button>
      </div>

      <div class="token-line" id="token-line-title">이어하기 토큰: -</div>

      <div class="slot-grid">
        <!-- SLOT 1 -->
        <div class="slot-card" id="slot-card-1">
          <div class="slot-head">
            <div class="slot-title">SLOT 1</div>
            <div class="slot-badges">
              <span class="badge" id="slot-badge-1">EMPTY</span>
              <span class="badge active" id="slot-active-1" style="display:none;">ACTIVE</span>
            </div>
          </div>
          <div class="slot-meta" id="slot-meta-1">-</div>
          <div class="slot-actions">
            <button class="menu-btn" id="slot-load-1" type="button">LOAD</button>
            <button class="menu-btn" id="slot-new-1" type="button">NEW</button>
            <button class="menu-btn ghost" id="slot-del-1" type="button">DELETE</button>
          </div>
        </div>

        <!-- SLOT 2 -->
        <div class="slot-card" id="slot-card-2">
          <div class="slot-head">
            <div class="slot-title">SLOT 2</div>
            <div class="slot-badges">
              <span class="badge" id="slot-badge-2">EMPTY</span>
              <span class="badge active" id="slot-active-2" style="display:none;">ACTIVE</span>
            </div>
          </div>
          <div class="slot-meta" id="slot-meta-2">-</div>
          <div class="slot-actions">
            <button class="menu-btn" id="slot-load-2" type="button">LOAD</button>
            <button class="menu-btn" id="slot-new-2" type="button">NEW</button>
            <button class="menu-btn ghost" id="slot-del-2" type="button">DELETE</button>
          </div>
        </div>

        <!-- SLOT 3 -->
        <div class="slot-card" id="slot-card-3">
          <div class="slot-head">
            <div class="slot-title">SLOT 3</div>
            <div class="slot-badges">
              <span class="badge" id="slot-badge-3">EMPTY</span>
              <span class="badge active" id="slot-active-3" style="display:none;">ACTIVE</span>
            </div>
          </div>
          <div class="slot-meta" id="slot-meta-3">-</div>
          <div class="slot-actions">
            <button class="menu-btn" id="slot-load-3" type="button">LOAD</button>
            <button class="menu-btn" id="slot-new-3" type="button">NEW</button>
            <button class="menu-btn ghost" id="slot-del-3" type="button">DELETE</button>
          </div>
        </div>
      </div>

      <div class="hint">조작: A/D 이동 · Space 점프 · P/ESC/⏸ 일시정지</div>
      <div class="hint dim">자동 저장은 “보스 클리어 → 보상 1개 선택 완료” 순간에만 발생합니다.</div>
      <div class="hint dim">플레이 중 TITLE을 열었으면 BACK TO GAME 또는 ESC/P로 되돌아갈 수 있습니다.</div>
    </div>
  </div>

  <!-- ===== PAUSE MENU ===== -->
  <div id="pause-menu" aria-hidden="true" style="display:none;">
    <div class="panel">
      <div class="panel-title">PAUSED</div>
      <div class="panel-sub">P / ESC / ⏸ : 토글</div>

      <div class="token-line" id="token-line-pause">이어하기 토큰: -</div>

      <div class="slot-switch">
        <div class="slot-switch-label">SAVE SLOT</div>
        <div class="slot-switch-buttons">
          <button class="slot-mini" id="mini-slot-1" type="button">1</button>
          <button class="slot-mini" id="mini-slot-2" type="button">2</button>
          <button class="slot-mini" id="mini-slot-3" type="button">3</button>
        </div>
        <div class="slot-switch-note" id="active-slot-note">ACTIVE: -</div>
      </div>

      <div class="panel-buttons">
        <button class="menu-btn" id="btn-resume" type="button">RESUME</button>
        <button class="menu-btn" id="btn-save" type="button">SAVE</button>
        <button class="menu-btn" id="btn-restart" type="button">NEW GAME</button>
        <button class="menu-btn ghost" id="btn-to-title" type="button">TITLE</button>
      </div>

      <div class="hint dim">수동 저장 또는 보스 체크포인트 저장이 있어야 “이어하기”가 가능합니다.</div>
    </div>
  </div>

  <!-- ===== REWARD MENU ===== -->
  <div id="reward-menu" aria-hidden="true" style="display:none;">
    <div class="panel">
      <div class="panel-title">BOSS CLEAR</div>
      <div class="panel-sub" id="reward-sub">WAVE 1 → 2</div>

      <div class="reward-grid">
        <button class="reward-btn" id="reward-0" type="button">
          <div class="reward-name" id="reward-name-0">-</div>
          <div class="reward-desc" id="reward-desc-0">-</div>
        </button>
        <button class="reward-btn" id="reward-1" type="button">
          <div class="reward-name" id="reward-name-1">-</div>
          <div class="reward-desc" id="reward-desc-1">-</div>
        </button>
        <button class="reward-btn" id="reward-2" type="button">
          <div class="reward-name" id="reward-name-2">-</div>
          <div class="reward-desc" id="reward-desc-2">-</div>
        </button>
      </div>

      <div class="hint dim">보상 1개 선택 완료 시, ACTIVE 슬롯에 체크포인트 자동 저장됩니다.</div>
    </div>
  </div>

  <!-- ===== GAME OVER ===== -->
  <div id="overlay" aria-hidden="true" style="display:none;">
    <div class="panel">
      <div class="panel-title">GAME OVER</div>
      <div id="final-result" class="final-result">-</div>

      <div class="token-line" id="token-line-over">이어하기 토큰: -</div>
      <div class="over-note" id="over-note">-</div>

      <div class="over-slot-grid">
        <button class="menu-btn" id="go-load-1" type="button">LOAD SLOT 1</button>
        <button class="menu-btn" id="go-load-2" type="button">LOAD SLOT 2</button>
        <button class="menu-btn" id="go-load-3" type="button">LOAD SLOT 3</button>
      </div>

      <div class="panel-buttons" style="margin-top:12px;">
        <button class="menu-btn" id="btn-retry" type="button">NEW GAME</button>
        <button class="menu-btn ghost" id="btn-over-title" type="button">TITLE</button>
      </div>

      <div class="hint dim">“이어하기”는 죽을 때 1회만 가능하며, 저장(수동/체크포인트)으로 다시 충전됩니다.</div>
    </div>
  </div>

  <canvas id="gameCanvas"></canvas>

  <!-- JS error viewer -->
  <script>
    (function(){
      const debug = document.getElementById('debug');
      function show(msg){
        if(!debug) return;
        debug.style.display='block';
        debug.textContent = msg;
      }
      window.__blade_show_debug = show;

      window.addEventListener('error', (e)=>{
        show(`JS ERROR: ${e.message}\n${e.filename}:${e.lineno}:${e.colno}`);
      });
      window.addEventListener('unhandledrejection', (e)=>{
        const r = (e && e.reason) ? (e.reason.stack || e.reason.message || String(e.reason)) : 'unknown';
        show(`PROMISE ERROR:\n${r}`);
      });

      setTimeout(()=>{
        if(!window.__BLADE_BOOTED){
          show(
            "game.js가 실행되지 않았습니다.\n" +
            "경로: ./js.html/game.js\n" +
            "Blade/index.html 과 같은 레벨에 js.html 폴더 + game.js가 있는지 확인하세요.\n" +
            "※ Live Server 권장"
          );
        }
      }, 2000);
    })();
  </script>

  <script src="./js.html/game.js" defer
    onerror="window.__blade_show_debug && window.__blade_show_debug('game.js 로드 실패!\\n경로: ./js.html/game.js\\n폴더/파일 이름을 확인하세요.');">
  </script>
</body>
</html>
